<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>İçerikUstam AI</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif}

body{
  height:100vh;
  background: radial-gradient(circle at 20% 20%,#1e3a8a,#020617 60%);
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
}

.app{
  width:95%;
  max-width:1000px;
  background:rgba(255,255,255,0.06);
  backdrop-filter:blur(25px);
  border-radius:26px;
  padding:30px;
  box-shadow:0 40px 100px rgba(0,0,0,0.7);
}

.logo{
  font-size:34px;
  font-weight:800;
  text-align:center;
  margin-bottom:25px;
  background:linear-gradient(90deg,#22c55e,#06b6d4,#a855f7);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

.panel{display:none}
.active{display:block}

.card{
  background:rgba(255,255,255,0.05);
  padding:18px;
  border-radius:18px;
  margin-bottom:15px;
}

input,select,textarea{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:rgba(0,0,0,0.5);
  color:white;
  margin-top:8px;
}

button{
  width:100%;
  padding:15px;
  border:none;
  border-radius:14px;
  font-weight:700;
  cursor:pointer;
  margin-top:12px;
  background:linear-gradient(90deg,#22c55e,#06b6d4);
  color:white;
}

.result{
  margin-top:18px;
  padding:18px;
  border-radius:14px;
  background:rgba(0,0,0,0.6);
  min-height:120px;
  white-space:pre-wrap;
}

.topbar{
  display:flex;
  justify-content:space-between;
  margin-bottom:15px;
}
</style>
</head>

<body>

<div class="app">
<div class="logo">İçerikUstam AI</div>

<div id="login" class="panel active">
<div class="card">
Giriş Yap
<input id="email" placeholder="Email">
<input id="pass" type="password" placeholder="Şifre">
<button onclick="login()">Giriş</button>
<button onclick="show('register')">Kayıt Ol</button>
</div>
</div>

<div id="register" class="panel">
<div class="card">
Kayıt Ol
<input id="rEmail" placeholder="Email">
<input id="rPass" type="password" placeholder="Şifre">
<button onclick="register()">Hesap Oluştur</button>
<button onclick="show('login')">Geri</button>
</div>
</div>

<div id="app" class="panel">
<div class="topbar">
<div id="userEmail"></div>
<div id="planBadge">FREE</div>
</div>

<div class="card">
<select id="type">
<option>Instagram Post</option>
<option>TikTok Video Script</option>
<option>YouTube Başlık</option>
<option>Reklam Metni</option>
<option>Ürün Açıklaması</option>
</select>
</div>

<div class="card">
<input id="topic" placeholder="Konu">
<textarea id="detail" placeholder="Detay"></textarea>
<button onclick="generate()">AI İçerik Üret</button>
</div>

<div class="result" id="result"></div>

<button onclick="logout()">Çıkış</button>

<div id="admin" style="display:none">
<button onclick="makePremium()">Premium Ver</button>
</div>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
const SUPABASE_URL="https://leszbkxssduuoytxdjii.supabase.co";
const SUPABASE_KEY="sb_publishable_mHIjYnEg9y7HVtBPY_Zr0w_6BcbGNTd";
const OPENAI_API_KEY="OPENAI_API_KEY";

const supabase=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

let currentUser=null;

function show(id){
document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"))
document.getElementById(id).classList.add("active")
}

async function register(){
const {error}=await supabase.auth.signUp({
email:rEmail.value,
password:rPass.value,
options:{emailRedirectTo:window.location.origin}
})
if(error)alert(error.message)
else{alert("Mail onayı gönderildi");show("login")}
}

async function login(){
const {data,error}=await supabase.auth.signInWithPassword({
email:email.value,
password:pass.value
})
if(error)return alert(error.message)

if(!data.user.email_confirmed_at){
alert("Mail onayı gerekli")
await supabase.auth.signOut()
return
}

currentUser=data.user
await ensureUser()
userEmail.innerText=currentUser.email
show("app")
}

async function ensureUser(){
const {data}=await supabase.from("users")
.select("*").eq("id",currentUser.id).single()

if(!data){
await supabase.from("users").insert({
id:currentUser.id,
email:currentUser.email
})
}
}

async function generate(){

let {data:user}=await supabase.from("users")
.select("*").eq("id",currentUser.id).single()

const today=new Date().toISOString().slice(0,10)

if(user.last_reset!==today){
await supabase.from("users")
.update({daily_usage:0,last_reset:today})
.eq("id",currentUser.id)
user.daily_usage=0
}

if(user.plan==="free" && user.daily_usage>=3)
return alert("Günlük limit doldu")

await supabase.from("users")
.update({daily_usage:user.daily_usage+1})
.eq("id",currentUser.id)

const prompt=${type.value} için içerik üret: ${topic.value} ${detail.value}

const res=await fetch("https://api.openai.com/v1/chat/completions",{
method:"POST",
headers:{
"Content-Type":"application/json",
"Authorization":"Bearer "+OPENAI_API_KEY
},
body:JSON.stringify({
model:"gpt-4.1-mini",
messages:[{role:"user",content:prompt}]
})
})

const json=await res.json()
result.innerText=json.choices?.[0]?.message?.content||"AI cevap vermedi"
}

async function makePremium(){
await supabase.from("users")
.update({plan:"premium"})
.eq("id",currentUser.id)
planBadge.innerText="PREMIUM"
alert("Premium aktif")
}

async function logout(){
await supabase.auth.signOut()
location.reload()
}
</script>

</body>
</html>
