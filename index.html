<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>İçerikUstam AI</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{margin:0;font-family:sans-serif;background:#020617;color:white;display:flex;justify-content:center;align-items:center;height:100vh}
.app{width:95%;max-width:900px;background:#111827;padding:25px;border-radius:20px}
.card{margin-bottom:15px}
input,select,textarea{width:100%;padding:12px;border-radius:10px;border:none;background:#0f172a;color:white;margin-top:8px}
button{width:100%;padding:14px;border:none;border-radius:12px;background:linear-gradient(90deg,#22c55e,#06b6d4);color:white;font-weight:700;margin-top:10px}
.result{margin-top:15px;padding:15px;background:#020617;border-radius:10px}
</style>
</head>

<body>

<div class="app">

<div id="login">
<div class="card">
Giriş
<input id="email" placeholder="Email">
<input id="pass" type="password" placeholder="Şifre">
<button onclick="login()">Giriş</button>
<button onclick="showRegister()">Kayıt Ol</button>
</div>
</div>

<div id="register" style="display:none">
<div class="card">
Kayıt
<input id="rEmail" placeholder="Email">
<input id="rPass" type="password" placeholder="Şifre">
<button onclick="register()">Hesap Oluştur</button>
<button onclick="showLogin()">Geri</button>
</div>
</div>

<div id="app" style="display:none">

<select id="type">
<option>Instagram Post</option>
<option>TikTok Video Script</option>
<option>Reklam Metni</option>
<option>Ürün Açıklaması</option>
</select>

<input id="topic" placeholder="Konu">
<textarea id="detail" placeholder="Detay"></textarea>

<button onclick="generate()">AI İçerik Üret</button>

<div class="result" id="result"></div>
<button onclick="logout()">Çıkış</button>

</div>

</div>

<script>
const SUPABASE_URL="https://leszbkxssduuoytxdjii.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxlc3pia3hzc2R1dW95dHhkamlpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyNzE2NTYsImV4cCI6MjA4Njg0NzY1Nn0.9pooVdILqrtVEXLQ2LmXHkf8jp7epkwaJhMfz6BEfus";
const OPENAI_API_KEY="OPENAI_KEY";

const supabase=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
let currentUser=null;

function showRegister(){login.style.display="none";register.style.display="block"}
function showLogin(){login.style.display="block";register.style.display="none"}

async function register(){
const {error}=await supabase.auth.signUp({
email:rEmail.value,
password:rPass.value,
options:{emailRedirectTo:location.origin}
});
if(error) alert(error.message);
else alert("Mailini onayla sonra giriş yap");
}

async function login(){
const {data,error}=await supabase.auth.signInWithPassword({
email:email.value,
password:pass.value
});
if(error) return alert(error.message);

if(!data.user.email_confirmed_at){
alert("Mail onayı gerekli");
await supabase.auth.signOut();
return;
}

currentUser=data.user;
await ensureUserRow();
login.style.display="none";
app.style.display="block";
}

async function ensureUserRow(){
const {data}=await supabase.from("users").select("*").eq("id",currentUser.id).single();

if(!data){
await supabase.from("users").insert({
id:currentUser.id,
email:currentUser.email
});
}
}

async function generate(){

let {data:user}=await supabase.from("users").select("*").eq("id",currentUser.id).single();

const today=new Date().toISOString().slice(0,10);
if(user.last_reset!==today){
await supabase.from("users").update({daily_usage:0,last_reset:today}).eq("id",currentUser.id);
user.daily_usage=0;
}

if(user.plan==="free" && user.daily_usage>=3){
alert("Günlük limit doldu");
return;
}

await supabase.from("users").update({
daily_usage:user.daily_usage+1
}).eq("id",currentUser.id);

const prompt=${type.value} için içerik üret: ${topic.value} ${detail.value};

const response=await fetch("https://api.openai.com/v1/chat/completions",{
method:"POST",
headers:{
"Content-Type":"application/json",
"Authorization":"Bearer "+OPENAI_API_KEY
},
body:JSON.stringify({
model:"gpt-4.1-mini",
messages:[{role:"user",content:prompt}]
})
});

const json=await response.json();
result.innerText=json.choices[0].message.content;
}

async function logout(){
await supabase.auth.signOut();
location.reload();
}
</script>

</body>
</html>
